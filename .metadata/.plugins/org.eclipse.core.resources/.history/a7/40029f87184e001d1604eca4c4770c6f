package musique.javax;

import java.io.File;
import java.io.IOException;

import javax.sound.sampled.LineUnavailableException;
import javax.sound.sampled.UnsupportedAudioFileException;

import musique.SonBref;
import musique.SonLong;

public class SonLongJavax extends SonLong
{
//public SonBref sons[];

/**
 * @param répertoire : chemin du dossier où est placé le fichier audio
 * @param nomFichier : nom du fichier audio se terminant par l'extension .wav
 * @param débutExtrait : en centièmes de secondes
 * @param finExtrait : en centièmes de secondes tel que débutExtrait < finExtrait
 * @param effectif : le passage extrait est découpé en effectif passages consécutifs
 * 
 * il faut choisir débutExtrait, finExtrait et effectif de telle sorte que finExtrait-débutExtrait soit un multiple de effectif
 * */
public SonLongJavax( File répertoire, String nomFichier, int débutExtrait, int finExtrait, int effectif) throws LineUnavailableException, 
                                                                                                                IOException, 
                                                                                                                UnsupportedAudioFileException 
{
super(new SonBrefJavax[effectif]);
//this.sons = new SonBrefJavax[effectif];
int i;
int deltaT = finExtrait-débutExtrait;

if (deltaT % effectif != 0) throw new IllegalArgumentException("dans SonLong(...) : finExtrait - débutExtrait n'est pas un multiple de effectif ");

int pas = deltaT/effectif;
int début, fin;
for ( i = 0, début = débutExtrait, fin = débutExtrait + pas; i < effectif; ++i, fin +=pas)
    {
    sons[i] = new SonBrefJavax(répertoire,nomFichier,début,fin);
    début = fin;
    }
}

/*public void joue(int i, int délai, double volume, double balance, double coeffPitch) throws InterruptedException
{
int j = i%this.sons.length;

Thread.sleep(délai);

sons[j].joue(volume,balance,coeffPitch);

}*/

/**
 * @param répertoireBruits : chemin du dossier où est stocké le fichiers audio .wav pour la création de l'objet sonLongJavax
 * @param s : s est supposée respecter le format suivant : 
 * nom du fichier audio (sans l'extension) début de l'extrait (en centièmes de secondes) fin de l'extrait (en centièmes de secondes) effectif
 * 
 * Exemple : s = "spitfire 1100 1700 30" 
 * Le caractère ' ' est le séparateur
 * 
 * @throws UnsupportedAudioFileException 
 * @throws IOException 
 * @throws LineUnavailableException 
 * 
 * Pour le détail des paramètres (débutExtrait,finExtrait,effectif) extraits de s, cf. constructeur ci-avant
 * 
 * */
public static SonLong crée(File répertoireBruits, String s) throws LineUnavailableException, IOException, UnsupportedAudioFileException
{       
String t[] = s.split(" ");
String nom = t[0];
nom +=".wav";
int débutExtrait = Integer.parseInt(t[1]);
int finExtrait = Integer.parseInt(t[2]);
int effectif = Integer.parseInt(t[3]);

return new SonLongJavax(répertoireBruits, nom, débutExtrait, finExtrait, effectif);
}
}
